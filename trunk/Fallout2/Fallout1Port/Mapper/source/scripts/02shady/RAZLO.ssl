/*

	Shady Sands - Razlo

*/

/* Include Files */
#include "..\headers\define.h"
//#include "..\headers\MAPNECRO.h"

#define NAME                    SCRIPT_RAZLO
#define TOWN_REP_VAR            (GVAR_TOWN_REP_SHADYSANDS)

#include "..\headers\command.h"
#include "..\headers\ModReact.h"

/* Standard Script Procedures */
procedure start;
procedure combat_p_proc;
procedure map_update_p_proc;
procedure talk_p_proc;
procedure critter_p_proc;
procedure look_at_p_proc;
procedure destroy_p_proc;
procedure pickup_p_proc;

procedure razlo00;
procedure razlo00a;
procedure razlo01;
procedure razlo02;
procedure razlo03;
procedure razlo04;
procedure razlo05;
procedure razlo06;
procedure razlo06na;
procedure razlo06nb;
procedure razlo07;
procedure razlo08;
procedure razlo09;
procedure razlo10;
procedure razlo11;
procedure razlo12;
procedure razlo14;
procedure razlo15;
procedure razlo17;
procedure razlo18;
procedure razlo19;
procedure razlo20;
procedure razlo21;
procedure razlo22;
procedure razlo23;
procedure razlo23a;
procedure razlo24;
procedure razlo25;
procedure razlo26;
procedure razlo27;
procedure razlo27a;
procedure razlo28;
procedure razlo29;
procedure razlo30;
procedure razlo31;
procedure razlo00n;
procedure razlo00n_a;
procedure razlo01n;
procedure razlo02n;
procedure razlo03n;
procedure razlo04n;
procedure razlo05n;
procedure razlo06n;
procedure razlo07n;
procedure razlo08n;
procedure razlo09n;
procedure razlo10n;
procedure razlo11n;
procedure razlo14n;
procedure razlo15n;
procedure razlo16n;
procedure razlowmpa;
procedure razlowmpb;
procedure razlofixa;
procedure razlofixb;
procedure razlofixc;
procedure razlox;
procedure razloend;

procedure givestuff;
procedure remove_items;

variable night_person;
variable wake_time;
variable sleep_time;
variable home_tile;
variable sleep_tile;

variable STIM;
variable FRUIT;
variable damage;
variable tmp_hostile;
variable heal;
variable COST;
variable BONUS;
variable NIGHT;
variable round_counter;
variable dummyvar;
variable MONEY;
variable MAX_HITS;
variable HITS;
variable initial :=  0;
variable tail;

procedure PickDeadBodyType;
variable DeathType := 56;

#define LVAR_Sleeping 							(9)

procedure start begin
	if shady_invaded then begin
		if (CUR_MAP_SHADYE) or (CUR_MAP_SHADYW) then begin //  SHADY SANDS - EAST OR WEST
			if (local_var(6) != 1) then begin
				set_local_var(6, 1);
				call PickDeadBodyType;
				kill_critter(self_obj, DeathType);
			end
		end
	end
end

procedure combat_p_proc begin
	if (fixed_param == 4) then begin
		round_counter := round_counter + 1;
	end
	if (round_counter > 3) then begin
		if not(global_var( GVAR_ENEMY_SHADY_SANDS )) then begin//Shady Sands is NOT tmp_hostile to player;  i.e. globalvar ENEMY_SHADY_SANDS is not enabled
			set_global_var( GVAR_ENEMY_SHADY_SANDS, 1 );//Set ENEMY_SHADY_SANDS to True
			set_global_var( GVAR_PLAYER_REPUTATION, check_general_rep - 5 );
		end
	end
end

procedure map_update_p_proc begin
	if not(initial) then begin
		set_self_team(TEAM_SHADY_SANDS );
		set_self_ai( AI_PEASANT );
		home_tile := 24529;
		sleep_tile := 23133;
		wake_time := 630;
		sleep_time := 2230;
		initial :=  0;
	end
end

procedure talk_p_proc begin
	dude_look_at_critter;
	MAX_HITS := dude_max_hp;
	HITS := dude_cur_hp;
	get_reaction
	if (has_rep_berserker) then begin
		set_global_var( GVAR_BERSERKER_REPUTATION, 1 );
		set_global_var( GVAR_CHAMPION_REPUTATION, 0 );
	end
	if (has_rep_champion) then begin
		set_global_var( GVAR_CHAMPION_REPUTATION, 1 );
		set_global_var( GVAR_BERSERKER_REPUTATION, 0 );
	end
	if (local_var(9) == 1) then begin
		float_msg(self_obj, message_str(SCRIPT_GENVAULT, 166), 0);
	end
	else begin
		if ((game_time_hour >= 1900) or (game_time_hour < 600)) then begin
			set_local_var(6, 1);
			start_gdialog(129, self_obj, 4, -1, -1);
			gsay_start;
			call razlo00n;
			gsay_end;
			end_dialogue;
		end
		else begin
			if (global_var( GVAR_RADSCORPION_SEED ) == 1) then begin
				if (tandi_is_kidnapped and (local_var(4) == 0) and (global_var( GVAR_TANDI_TALKED_ABOUT ) == 1)) then begin
					set_local_var(4, 1);
					start_gdialog(129, self_obj, 4, -1, -1);
					gsay_start;
					call razlo01;
					gsay_end;
					end_dialogue;
				end
				else begin
					start_gdialog(129, self_obj, 4, -1, -1);
					gsay_start;
					call razlo23;
					gsay_end;
					end_dialogue;
				end
			end
			else begin
				if (dude_item_count( PID_SCORPION_TAIL )) then begin
					start_gdialog(129, self_obj, 4, -1, -1);
					gsay_start;
					call razlo23;
					gsay_end;
					end_dialogue;
				end
				else begin
					if ((local_var(6) == 0) and (local_var(1) >= 2)) then begin
						set_local_var(6, 1);
						start_gdialog(129, self_obj, 4, -1, -1);
						gsay_start;
						call razlo10;
						gsay_end;
						end_dialogue;
					end
					else begin
						if (local_var(6) == 0) then begin
							set_local_var(6, 1);
							start_gdialog(129, self_obj, 4, -1, -1);
							gsay_start;
							call razlo18;
							gsay_end;
							end_dialogue;
						end
						else begin
							if (global_var( GVAR_TANDI_HIRELING_STATUS ) == 3) then begin
								call razlo09;
							end
							else begin
								if ((global_var( GVAR_TANDI_HIRELING_STATUS ) == 2) and (local_var(5) == 0)) then begin
									set_local_var(5, 1);
									call razlo08;
								end
								else begin
									if (tandi_is_kidnapped and (local_var(4) == 0) and (global_var( GVAR_TANDI_TALKED_ABOUT ) == 1)) then begin
										set_local_var(4, 1);
										start_gdialog(129, self_obj, 4, -1, -1);
										gsay_start;
										call razlo01;
										gsay_end;
										end_dialogue;
									end
									else begin
										if (tandi_is_kidnapped and (global_var( GVAR_TANDI_TALKED_ABOUT ) == 1) and (local_var(4) == 1)) then begin
											set_local_var(4, 2);
											call razlo07;
										end
										else begin
											if (has_rep_berserker or has_rep_childkiller) then begin
												start_gdialog(129, self_obj, 4, -1, -1);
												gsay_start;
												call razlo00;
												gsay_end;
												end_dialogue;
												display_msg(message_str(SCRIPT_RAZLO, 103));
											end
											else begin
												if (local_var(1) >= 2) then begin
													start_gdialog(129, self_obj, 4, -1, -1);
													gsay_start;
													call razlo19;
													gsay_end;
													end_dialogue;
												end
												else begin
													start_gdialog(129, self_obj, 4, -1, -1);
													gsay_start;
													call razlo21;
													gsay_end;
													end_dialogue;
												end
											end
										end
									end
								end
							end
						end
					end
				end
			end
		end
	end
	call remove_items;
end

procedure razlo00
begin
	gsay_message(129, 101, 50);
end

procedure razlo00a
begin
	display_msg(message_str(SCRIPT_RAZLO, 103));
end

procedure razlo01
begin
	gsay_reply(129, 104);
	if (tandi_is_kidnapped and (global_var( GVAR_TANDI_TALKED_ABOUT ) == 1)) then begin
		giq_option( 4, SCRIPT_RAZLO, 105, razlo03, NEUTRAL_REACTION );
	end
	giq_option( 4, SCRIPT_RAZLO, 143, razlo22, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 144, razlo23a, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 106, razlo02, NEUTRAL_REACTION );
end

procedure razlo02
begin
	gsay_message(129, 107, 50);
	set_local_var(4, 1);
end

procedure razlo03
begin
	set_local_var(4, 1);
	gsay_reply(129, 108);
	giq_option( 5, SCRIPT_RAZLO, 110, razlo04, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 109, razloend, NEUTRAL_REACTION );
	giq_option( 5, SCRIPT_RAZLO, 111, razloend, NEUTRAL_REACTION );
end

procedure razlo04
begin
	gsay_reply(129, 112);
	giq_option( 4, SCRIPT_RAZLO, 113, razlo05, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 114, razlo06, NEUTRAL_REACTION );
end

procedure razlo05
begin
	gsay_message(129, 115, 50);
end

procedure razlo06
begin
	gsay_message(129, 116, 50);
	call givestuff;
end

procedure razlo06na
begin
	gsay_message(129, 306, 50);
	call razlo06nb;
end

procedure razlo06nb
begin
	variable LVar0 := 0;
	variable LVar1 := 0;
	gsay_message(129, 307, 50);
	LVar0 := create_object( PID_ANTIDOTE, 0, 0 );
	add_obj_to_inven(dude_obj, LVar0);
	LVar1 := dude_item( PID_SCORPION_TAIL );
	rm_obj_from_inven(dude_obj, LVar1);
	destroy_object(LVar1);
	if (local_var(7) == 0) then begin
		set_local_var(7, 1);
		give_exp_points(250);
		display_msg(message_str(SCRIPT_RAZLO, 300));
	end
	gfade_out(1);
	game_time_advance(game_ticks(1200 * damage));
	gfade_in(1);
	critter_heal(dude_obj, damage);
end

procedure razlo07
begin
	float_msg(self_obj, message_str(SCRIPT_RAZLO, 117), 2);
end

procedure razlo08
begin
	float_msg(self_obj, message_str(SCRIPT_RAZLO, 118), 7);
end

procedure razlo09
begin
	float_msg(self_obj, message_str(SCRIPT_RAZLO, 119), 12);
end

procedure razlo10
begin
	gsay_reply(129, 120);
	giq_option( 4, SCRIPT_RAZLO, 122, razlo14, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 144, razlo23a, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 121, razloend, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 123, razlo11, NEUTRAL_REACTION );
end

procedure razlo11
begin
	gsay_message(129, 124, 50);
	damage := MAX_HITS - HITS;
	if (damage > (MAX_HITS / 4)) then begin
		call razlo14;
	end
	else begin
		call razlo12;
	end
end

procedure razlo12
begin
	gsay_message(129, 125, 50);
end

procedure razlo14
begin
	gsay_message(129, 126, 50);
	damage := MAX_HITS - HITS;
	if (damage < (MAX_HITS / 4)) then begin
		call razlowmpa;
	end
	else begin
		if (damage < (MAX_HITS / 2)) then begin
			call razlofixa;
		end
		else begin
			if (damage < (3 * MAX_HITS / 4)) then begin
				call razlofixb;
			end
			else begin
				call razlofixc;
			end
		end
	end
end

procedure razlo15
begin
	gsay_message(129, 127, 50);
end

procedure razlo17
begin
	variable LVar0 := 0;
	if (damage < (MAX_HITS / 2)) then begin
		LVar0 := create_object( PID_BARTER_LIGHT_HEALING, 0, 0 );
		add_obj_to_inven(self_obj, LVar0);
	end
	else begin
		if (damage < (3 * MAX_HITS / 4)) then begin
			LVar0 := create_object( PID_BARTER_MEDIUM_HEALING, 0, 0 );
			add_obj_to_inven(self_obj, LVar0);
		end
		else begin
			LVar0 := create_object( PID_BARTER_HEAVY_HEALING, 0, 0 );
			add_obj_to_inven(self_obj, LVar0);
		end
	end
	gdialog_mod_barter(0);
	gsay_message(129, 126, 50);
	call razlo08n;
end

procedure razlo18
begin
	gsay_reply(129, 128);
	giq_option( 4, SCRIPT_RAZLO, 130, razlo14, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 144, razlo23a, NEUTRAL_REACTION );
	giq_option( 5, SCRIPT_RAZLO, 129, razloend, NEUTRAL_REACTION );
end

procedure razlo19
begin
	gsay_reply(129, 131);
	giq_option( 4, SCRIPT_RAZLO, 132, razlo20, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 143, razlo22, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 144, razlo23a, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 134, razlo11, NEUTRAL_REACTION );
end

procedure razlo20
begin
	gsay_message(129, 135, 50);
end

procedure razlo21
begin
	gsay_reply(129, 136);
	giq_option( 4, SCRIPT_RAZLO, 138, razlo22, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 144, razlo23a, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 139, razlo11, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 137, razloend, NEUTRAL_REACTION );
end

procedure razlo22
begin
	gsay_message(129, 140, 50);
	call razlo14;
end

procedure razlo23
begin
	gsay_reply(129, 141);
	giq_option( 4, SCRIPT_RAZLO, 143, razlo22, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 144, razlo23a, NEUTRAL_REACTION );
	giq_option( 5, SCRIPT_RAZLO, 145, razlo27, NEUTRAL_REACTION );
	if (dude_item_count( PID_SCORPION_TAIL )) then begin
		giq_option( 4, SCRIPT_RAZLO, 146, razlo30, NEUTRAL_REACTION );
		giq_option( -3, SCRIPT_RAZLO, 303, razlo30, NEUTRAL_REACTION );
	end
	giq_option( 4, SCRIPT_RAZLO, 142, razloend, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 147, razlo11, NEUTRAL_REACTION );
end

procedure razlo23a
begin
	if (local_var(8) == 1) then begin
		call razlo25;
	end
	else begin
		call razlo24;
	end
end

procedure razlo24
begin
	gsay_message(129, 148, 50);
end

procedure razlo25
begin
	gsay_message(129, 149, 50);
	if (dude_poison_stat != 0) then begin
		gsay_message(129, 150, 50);
		poison(dude_obj, -dude_poison_stat);
		call razlo26;
	end
	else begin
		gsay_message(129, 151, 50);
	end
end

procedure razlo26
begin
	gsay_message(129, 152, 50);
end

procedure razlo27
begin
	gsay_message(129, 153, 50);
	gsay_reply(129, 154);
	giq_option( 5, SCRIPT_RAZLO, 156, razlo29, NEUTRAL_REACTION );
	giq_option( 5, SCRIPT_RAZLO, 157, razlo28, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 155, razlo27a, GOOD_REACTION );
end

procedure razlo27a
begin
	UpReact
end

procedure razlo28
begin
	gsay_reply(129, 158);
	giq_option( 5, SCRIPT_RAZLO, 159, razloend, NEUTRAL_REACTION );
end

procedure razlo29
begin
	gsay_message(129, 160, 50);
end

procedure razlo30
begin
	gsay_message(129, 161, 50);
	gfade_out(1);
	game_time_advance(game_ticks(14400));
	gfade_in(1);
	set_local_var(8, 1);
	call razlo31;
end

procedure razlo31
begin
	variable LVar0 := 0;
	gsay_message(129, 162, 50);
	LVar0 := create_object( PID_ANTIDOTE, 0, 0 );
	add_obj_to_inven(dude_obj, LVar0);
	tail := dude_item( PID_SCORPION_TAIL );
	rm_obj_from_inven(dude_obj, tail);
	destroy_object(tail);
	if (local_var(7) == 0) then begin
		set_local_var(7, 1);
		give_exp_points(250);
		display_msg(message_str(SCRIPT_RAZLO, 300));
	end
end

procedure razlo00n
begin
	gsay_reply(129, 163);
	giq_option( 4, SCRIPT_RAZLO, 164, razlo00n_a, NEUTRAL_REACTION );
	if (global_var( GVAR_RADSCORPION_SEED ) == 1) then begin
		giq_option( 5, SCRIPT_RAZLO, 165, razlo09n, NEUTRAL_REACTION );
	end
	if (tandi_is_kidnapped and (global_var( GVAR_TANDI_TALKED_ABOUT ) == 1)) then begin
		giq_option( 5, SCRIPT_RAZLO, 166, razlo15n, NEUTRAL_REACTION );
	end
	giq_option( -3, SCRIPT_RAZLO, 167, razlo01n, NEUTRAL_REACTION );
end

procedure razlo01n
begin
	gsay_message(129, 168, 50);
	DownReact
end

procedure razlo02n
begin
	gsay_reply(129, 169);
	giq_option( 4, SCRIPT_RAZLO, 170, razlo04n, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 171, razlo03n, NEUTRAL_REACTION );
end

procedure razlo03n
begin
	gsay_message(129, 172, 50);
	DownReact
end

procedure razlo04n
begin
	gsay_reply(129, 173);
	giq_option( 4, SCRIPT_RAZLO, 174, razlo05n, NEUTRAL_REACTION );
end

procedure razlo05n
begin
	damage := MAX_HITS - HITS;
	if (damage < (MAX_HITS / 4)) then begin
		call razlowmpb;
	end
	else begin
		if (damage < (MAX_HITS / 2)) then begin
			call razlofixa;
		end
		else begin
			if (damage < (3 * MAX_HITS / 4)) then begin
				call razlofixb;
			end
			else begin
				call razlofixc;
			end
		end
	end
end

procedure razlo06n
begin
	gsay_reply(129, 186);
	giq_option( 4, SCRIPT_RAZLO, 187, razlo17, NEUTRAL_REACTION );
	if (dude_item_count( PID_SCORPION_TAIL )) then begin
		giq_option( 4, SCRIPT_RAZLO, 305, razlo06na, NEUTRAL_REACTION );
		giq_option( -3, SCRIPT_RAZLO, 303, razlo06na, NEUTRAL_REACTION );
	end
	giq_option( 4, SCRIPT_RAZLO, 188, razloend, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 304, razlo17, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 302, razloend, NEUTRAL_REACTION );
end

procedure razlo07n
begin
	gsay_message(129, 189, 49);
end

procedure razlo08n
begin
	/* has how many? */    if (dude_item_count( PID_BARTER_LIGHT_HEALING ) or dude_item_count( PID_BARTER_MEDIUM_HEALING ) or dude_item_count( PID_BARTER_HEAVY_HEALING )) then begin
		call razlo14n;
	end
	else begin
		if (dude_caps >= COST) then begin
			dude_caps_adjust( -COST );
			call razlo14n;
		end
		else begin
			call razlo06n;
		end
	end
end

procedure razlo09n
begin
	gsay_reply(129, 190);
	giq_option( 6, SCRIPT_RAZLO, 191, razlo10n, NEUTRAL_REACTION );
end

procedure razlo10n
begin
	gsay_message(129, 192, 50);
end

procedure razlo11n
begin
	gsay_reply(129, 108);
	giq_option( 5, SCRIPT_RAZLO, 194, razlo04, NEUTRAL_REACTION );
	giq_option( 5, SCRIPT_RAZLO, 195, razloend, NEUTRAL_REACTION );
end

procedure razlo14n
begin
	gsay_message(129, 196, 50);
	gfade_out(1);
	game_time_advance(game_ticks(1200 * damage));
	gfade_in(1);
	critter_heal(dude_obj, damage);
end

procedure razlo15n
begin
	if (local_var(11) == 1) then begin
		call razlo16n;
	end
	else begin
		set_local_var(11, 1);
		call razlo11n;
	end
end

procedure razlo16n
begin
	gsay_message(129, 197, 50);
end

procedure razlowmpa
begin
	gsay_message(129, 175, 50);
end

procedure razlowmpb
begin
	gsay_message(129, 176, 50);
end

procedure razlofixa
begin
	COST := 25;
	gsay_reply(129, 177);
	giq_option( 4, SCRIPT_RAZLO, 178, razlo08n, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 179, razlo06n, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 301, razlo08n, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 302, razloend, NEUTRAL_REACTION );
end

procedure razlofixb
begin
	COST := 50;
	gsay_reply(129, 180);
	giq_option( 4, SCRIPT_RAZLO, 181, razlo08n, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 182, razlo06n, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 301, razlo08n, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 302, razloend, NEUTRAL_REACTION );
end

procedure razlofixc
begin
	COST := 100;
	gsay_reply(129, 183);
	giq_option( 4, SCRIPT_RAZLO, 184, razlo08n, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_RAZLO, 185, razlo06n, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 301, razlo08n, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_RAZLO, 302, razloend, NEUTRAL_REACTION );
end

procedure razlox
begin
end

procedure razloend
begin
end

procedure givestuff
begin
	variable LVar0 := 0;
	LVar0 := create_object( PID_STIMPAK, 0, 0 );
	add_obj_to_inven(dude_obj, LVar0);
	LVar0 := create_object( PID_STIMPAK, 0, 0 );
	add_obj_to_inven(dude_obj, LVar0);
	LVar0 := create_object( PID_MUTATED_FRUIT, 0, 0 );
	add_obj_to_inven(dude_obj, LVar0);
	if (local_var(8) == 1) then begin
		LVar0 := create_object( PID_ANTIDOTE, 0, 0 );
		add_obj_to_inven(dude_obj, LVar0);
	end
end

procedure remove_items
begin
	variable LVar0 := 0;
	/* has how many? */    if (dude_item_count( PID_BARTER_LIGHT_HEALING )) then begin
		LVar0 := dude_item( PID_BARTER_LIGHT_HEALING );
		rm_obj_from_inven(dude_obj, LVar0);
		destroy_object(LVar0);
	end
	/* has how many? */    if (self_item_count( PID_BARTER_LIGHT_HEALING )) then begin
		LVar0 := self_item( PID_BARTER_LIGHT_HEALING );
		rm_obj_from_inven(self_obj, LVar0);
		destroy_object(LVar0);
	end
	/* has how many? */    if (dude_item_count( PID_BARTER_MEDIUM_HEALING )) then begin
		LVar0 := dude_item( PID_BARTER_MEDIUM_HEALING );
		rm_obj_from_inven(dude_obj, LVar0);
		destroy_object(LVar0);
	end
	/* has how many? */    if (self_item_count( PID_BARTER_MEDIUM_HEALING )) then begin
		LVar0 := self_item( PID_BARTER_MEDIUM_HEALING );
		rm_obj_from_inven(self_obj, LVar0);
		destroy_object(LVar0);
	end
	/* has how many? */    if (dude_item_count( PID_BARTER_HEAVY_HEALING )) then begin
		LVar0 := dude_item( PID_BARTER_HEAVY_HEALING );
		rm_obj_from_inven(dude_obj, LVar0);
		destroy_object(LVar0);
	end
	/* has how many? */    if (self_item_count( PID_BARTER_HEAVY_HEALING )) then begin
		LVar0 := self_item( PID_BARTER_HEAVY_HEALING );
		rm_obj_from_inven(self_obj, LVar0);
		destroy_object(LVar0);
	end
end

procedure critter_p_proc
begin
	if (map_var(2) == 1) then begin
		set_local_var(10, local_var(10) + 1);
		set_map_var(2, 0);
		if (local_var(10) < 3) then begin
			float_msg(self_obj, message_str(SCRIPT_RAZLO, 308), 2);
		end
		else begin
			tmp_hostile := 1;
		end
	end
	if (obj_can_see_obj(self_obj, dude_obj)) then begin
		if global_var( GVAR_ENEMY_SHADY_SANDS ) then begin//   Is Shady Sands tmp_hostile to player?
			tmp_hostile := 1;
		end
	end
	if (tmp_hostile) then begin
		tmp_hostile := 0;
		attack(dude_obj);
	end
end

procedure look_at_p_proc
begin
	script_overrides;
	display_msg(message_str(SCRIPT_RAZLO, 100));
end

procedure destroy_p_proc begin
	inc_good_critter
	if (source_obj == dude_obj) then begin
		set_global_var( GVAR_ENEMY_SHADY_SANDS, 1 );//Set ENEMY_SHADY_SANDS to True
	end
end

procedure pickup_p_proc begin
	tmp_hostile := 1;
end

procedure razlo00n_a begin
	if (has_rep_berserker or has_rep_childkiller) then begin
		call razlo02n;
	end
	else begin
		call razlo00;
	end
end



procedure PickDeadBodyType
begin
	pick_dead_body_type
end
