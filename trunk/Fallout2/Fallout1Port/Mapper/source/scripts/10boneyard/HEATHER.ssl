/*

	Boneyard - FoA scout

*/

/* Include Files */
#include "..\headers\define.h"
//#include "..\headers\MAPNECRO.h"

#define NAME                    SCRIPT_HEATHER
#define TOWN_REP_VAR            (GVAR_TOWN_REP_BONEYARD)

#include "..\headers\command.h"
#include "..\headers\ModReact.h"

/* Standard Script Procedures */
procedure start;
procedure critter_p_proc;
procedure destroy_p_proc;
procedure look_at_p_proc;
procedure pickup_p_proc;
procedure talk_p_proc;

procedure heather0;
procedure heather0a;
procedure heather0b;
procedure heather1;
procedure heather1a;
procedure heather2;
procedure heather3;
procedure heather3a;
procedure heather3b;
procedure heather3c;
procedure heather4;
procedure heather5;
procedure heather5a;
procedure heather6;
procedure heather7;
procedure heather8;
procedure heather9;
procedure heather10;
procedure heather11;
procedure heather12;
procedure heather13;
procedure heather14;
procedure heather15;
procedure heather16;
procedure heather17;
procedure heather18;
procedure heather19;
procedure heather20;
procedure heather21;
procedure heather22;
procedure heather22a;
procedure heather23;
procedure heather24;
procedure heather25;
procedure heather26;
procedure heather27;
procedure heather28;
procedure HeatherEnd;
procedure combat;

variable tmp_hostile;
variable initial :=  0;

#define LVAR_SoldInformation 	(5)

procedure start begin
	if self_obj != 0 then begin
		set_global_var( GVAR_IS_HEATHER_ALIVE, 1 );
	end
	else begin
		set_global_var( GVAR_IS_HEATHER_ALIVE, 0 );
	end

	if not(initial) then begin
		set_self_team( TEAM_CATHEDRAL );
		set_self_ai( AI_CHILDREN_TRUE );
		initial :=  1;
	end
end

procedure critter_p_proc begin
	if (global_var( GVAR_QUEST_BONEYARD_3_BOMBFOLL ) == 2) then begin
		kill_critter(self_obj, ANIM_burned_to_nothing_sf);
	end
	else begin
		if (tmp_hostile) then begin
			tmp_hostile := 0;
			attack(dude_obj);
		end
	end
end

procedure destroy_p_proc begin
	set_global_var( GVAR_IS_HEATHER_ALIVE, 0 );
	set_global_var( GVAR_QUEST_BONEYARD_4_FIND_SPY, 2 );
   inc_good_critter
end

procedure look_at_p_proc begin
	script_overrides;
	display_msg(message_str(SCRIPT_HEATHER, 100));
end

procedure pickup_p_proc begin
	tmp_hostile := 1;
end

procedure talk_p_proc begin
	script_overrides;
	dude_look_at_critter;
	get_reaction
	if ((game_time_hour >= 700) and (game_time_hour < 1800)) then begin
		start_dialog_at_node(heather0);
	end
	else begin
		call heather28;
	end
end

procedure heather0 begin
	Reply(101);
	giq_option( -3, SCRIPT_HEATHER, 102, combat, NEUTRAL_REACTION );
	giq_option( -3, SCRIPT_HEATHER, 103, HeatherEnd, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 104, heather0a, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 105, combat, NEUTRAL_REACTION );
	giq_option( 6, SCRIPT_HEATHER, 106, heather0b, NEUTRAL_REACTION );
end

procedure heather0a begin
	if (local_var(LVAR_reaction_level) < 2) then begin
		call heather19;
	end
	else begin
		call heather1;
	end
end

procedure heather0b begin
	if (local_var(LVAR_reaction_level) < 2) then begin
		call heather27;
	end
	else begin
		call heather21;
	end
end

procedure heather1 begin
	Reply(107);
	if (dude_is_male) then begin
		giq_option( 4, SCRIPT_HEATHER, 108, heather2, NEUTRAL_REACTION );
	end
	if (global_var( GVAR_QUEST_BONEYARD_4_FIND_SPY ) == 1) then begin
		giq_option( 4, SCRIPT_HEATHER, 109, heather1a, NEUTRAL_REACTION );
	end
	giq_option( 4, SCRIPT_HEATHER, 110, heather19, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 111, heather20, NEUTRAL_REACTION );
end

procedure heather1a begin
	BigDownReact
	call heather3;
end

procedure heather2 begin
	gsay_message(266, 112, 50);
end

procedure heather3 begin
	Reply(113);
	giq_option( 5, SCRIPT_HEATHER, 114, heather3a, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 115, heather3b, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 116, heather3c, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 117, HeatherEnd, NEUTRAL_REACTION );
end

procedure heather3a begin
	DownReact
	call heather4;
end

procedure heather3b begin
	UpReact
	call heather10;
end

procedure heather3c begin
	BigDownReact
	call heather8;
end

procedure heather4
begin
	Reply(118);
	giq_option( 5, SCRIPT_HEATHER, 119, heather5, NEUTRAL_REACTION );
	giq_option( 6, SCRIPT_HEATHER, 120, heather10, NEUTRAL_REACTION );
	giq_option( 7, SCRIPT_HEATHER, 121, heather17, NEUTRAL_REACTION );
end

procedure heather5 begin
	Reply(122);
	giq_option( 5, SCRIPT_HEATHER, 123, heather5a, NEUTRAL_REACTION );
	giq_option( 5, SCRIPT_HEATHER, 124, heather7, NEUTRAL_REACTION );
	giq_option( 6, SCRIPT_HEATHER, 125, heather9, NEUTRAL_REACTION );
end

procedure heather5a begin
	BigUpReact
	call heather6;
end

procedure heather6 begin
	gsay_message(266, 126, 50);
end

procedure heather7 begin
	Reply(127);
	giq_option( 4, SCRIPT_HEATHER, 128, heather6, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 129, heather8, NEUTRAL_REACTION );
end

procedure heather8 begin
	gsay_message(266, 130, 50);
	call combat;
end

procedure heather9 begin
	Reply(131);
	giq_option( 4, SCRIPT_HEATHER, 132, heather6, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 133, heather8, NEUTRAL_REACTION );
end

procedure heather10 begin
	Reply(134);
	giq_option( 4, SCRIPT_HEATHER, 135, heather11, NEUTRAL_REACTION );
	giq_option( 5, SCRIPT_HEATHER, 136, heather12, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 137, HeatherEnd, NEUTRAL_REACTION );
end

procedure heather11 begin
	Reply(138);
	giq_option( 4, SCRIPT_HEATHER, 139, HeatherEnd, NEUTRAL_REACTION );
end

procedure heather12 begin
	Reply(140);
	giq_option( 4, SCRIPT_HEATHER, 141, heather6, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 142, heather13, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 143, HeatherEnd, NEUTRAL_REACTION );
end

procedure heather13 begin
	Reply(144);
	giq_option( 4, SCRIPT_HEATHER, 145, heather14, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 146, heather15, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 147, heather16, NEUTRAL_REACTION );
end

procedure heather14 begin
	Reply(148);
	giq_option( 4, SCRIPT_HEATHER, 149, heather6, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 150, heather8, NEUTRAL_REACTION );
end

procedure heather15 begin
	Reply(151);
	giq_option( 4, SCRIPT_HEATHER, 152, heather8, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 153, combat, NEUTRAL_REACTION );
end

procedure heather16 begin
	gsay_message(266, 154, 50);
end

procedure heather17 begin
	Reply(155);
	giq_option( 4, SCRIPT_HEATHER, 156, heather8, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 157, heather18, NEUTRAL_REACTION );
end

procedure heather18 begin
	Reply(158);
	giq_option( 4, SCRIPT_HEATHER, 159, heather8, NEUTRAL_REACTION );
	giq_option( 4, SCRIPT_HEATHER, 160, heather6, NEUTRAL_REACTION );
end

procedure heather19 begin
	gsay_message(266, 161, 50);
end

procedure heather20 begin
	gsay_message(266, 162, 50);
end

procedure heather21 begin
	if (local_var(LVAR_SoldInformation) == 0) then begin
		Reply(163);
		giq_option( 6, SCRIPT_HEATHER, 164, heather22, NEUTRAL_REACTION );
		giq_option( 6, SCRIPT_HEATHER, 165, heather26, NEUTRAL_REACTION );
		giq_option( 6, SCRIPT_HEATHER, 166, heather25, NEUTRAL_REACTION );
	end
	else begin
		Reply(200);
		NOption(g_bye, HeatherEnd, 4);
	end
end

procedure heather22 begin
	Reply(167);
	giq_option( 6, SCRIPT_HEATHER, 168, heather22a, NEUTRAL_REACTION );
	giq_option( 6, SCRIPT_HEATHER, 169, heather25, NEUTRAL_REACTION );
end

procedure heather22a begin
	variable LVar0 := 0;
	if (dude_caps >= 300) then begin
		item_caps_adjust(dude_obj, -300);
		set_local_var(LVAR_SoldInformation,1);
		call heather23;
	end
	else begin
		call heather24;
	end
end

procedure heather23 begin
	gsay_message(266, 170, 50);
end

procedure heather24 begin
	gsay_message(266, 171, 50);
	call combat;
end

procedure heather25 begin
	gsay_message(266, 172, 50);
end

procedure heather26 begin
	Reply(173);
	giq_option( 6, SCRIPT_HEATHER, 174, heather22a, NEUTRAL_REACTION );
	giq_option( 6, SCRIPT_HEATHER, 175, heather25, NEUTRAL_REACTION );
end

procedure heather27 begin
	gsay_message(266, 176, 50);
end

procedure heather28 begin
	float_msg(self_obj, message_str(SCRIPT_HEATHER, 177), 0);
end

procedure HeatherEnd begin
end

procedure combat begin
	tmp_hostile := 1;
end






