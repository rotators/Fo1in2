/*******************************************************************************
        Name: Old bed
        Location: Necropolis
        Description: Griffith is hiding the fuel cell controller for the motorcycle here.

            Created: by sFall Script Editor
            Updated:

*******************************************************************************/

/* Include Files */
#include "..\headers\define.h"
#include "..\headers\Sfall\main.h"
//#include "..\headers\MAPNECRO.h"

#define NAME                    SCRIPT_GRIFFBED

#include "..\headers\command.h"
//#include "..\headers\ModReact.h"
//#include "..\headers\updatmap.h"


/* Standard Script Procedures */
procedure start;
procedure description_p_proc;
procedure look_at_p_proc;
procedure use_p_proc;
procedure use_skill_on_p_proc;

procedure find_controller;

/* Defines */


/*****************************************************************
   Local Variables which are saved.
   All Local Variables need to be prepended by LVAR_
*****************************************************************/
#define LVAR_FoundController 		(0)

/*******************************************************************
   Imported variables from the Map scripts. These should only be
   pointers and variables that need not be saved. If a variable
   Needs to be saved, make it a map variable (MVAR_)
*******************************************************************/


/*******************************************************************
   Local variables which do not need to be saved between map changes.
*******************************************************************/
variable Perception_Check;
variable Item;

/*******************************************************************
*                           PROCEDURES                             *
*******************************************************************/

procedure start begin
end

procedure look_at_p_proc begin
end

procedure description_p_proc begin
	if not(fo1in2_motorcycle_disabled) then begin
	   script_overrides;

		if (local_var(LVAR_FoundController) == 1) then begin
			if (global_var(GVAR_QUEST_MOTORCYCLE) < 5) then begin
				display_msg(111);
			end
			else begin
				display_msg(112);
			end
		end
		else begin
			script_overrides;
		   if (dude_perception > 5 or is_success(roll_vs_skill(dude_obj, SKILL_OUTDOORSMAN, -40)) or is_success(roll_vs_skill(dude_obj, SKILL_STEAL, -20)))  then begin
		   	set_local_var(LVAR_FoundController,1);
		   	set_proto_data(self_pid,PROTO_IT_FLAGS,RMOBJ_USE_OBJ);
		   	display_msg(110);
		   end
		   else begin
		   	display_msg(random(100,102));
		   end
		end
	end
end

procedure use_p_proc begin
	if (global_var(GVAR_QUEST_MOTORCYCLE) < 5) then begin
		call find_controller;
	end
	else begin
		display_msg(120);
	end
end

procedure use_skill_on_p_proc begin
variable Skill_Used;

	if (Skill_Used == SKILL_TRAPS or Skill_Used == SKILL_STEAL) then begin
		script_overrides;
		call description_p_proc;
	end
end

procedure find_controller begin
   Item:=create_object(PID_MOTO_KEY,0,0);
   add_mult_objs_to_inven(dude_obj,Item,1);

   set_global_var(GVAR_QUEST_MOTORCYCLE,5);
   display_msg(120);
end
